#include "mainwindow.h"
#include "ui_mainwindow.h"

MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    libusb_init(0);
    kbd=0;
}

MainWindow::~MainWindow()
{
    delete ui;
    libusb_exit(0);
}

void MainWindow::on_action_D87_triggered()
{
    ui->lineEdit->setText("3311");
    ui->lineEdit_2->setText("A295");
}

void MainWindow::on_actionAP_2_triggered()
{
    QMessageBox::information(this,"","暂未测试AP2，可手动填写自行测试！");
}

void MainWindow::on_pushButton_clicked()
{
    int vid,pid;
    vid=ui->lineEdit->text().toInt(0,16);
    pid=ui->lineEdit_2->text().toInt(0,16);
    if(kbd)delete kbd;
    kbd=new TKbdObj(vid,pid);
}

void MainWindow::on_pushButton_2_clicked()
{
    if(!kbd)return;
    char d[2]={0},str[]="iloveyou";
    for(int x=0;x<3;x++){
        kbd->clear();
        for(int i=0;i<sizeof(str);i++){
            d[0]=str[i];
            kbd->on(d,0xFF0000);//red
            if(i){
                d[0]=str[i-1];
                kbd->on(d,0xFF00);//green
            }
            kbd->show();
            Sleep(300);
        }
    }
}

void MainWindow::on_pushButton_3_clicked()
{
    if(!kbd)return;
    int rgb=kbd->rgb(0,0,255);//blue
    kbd->on("pause",rgb);
    kbd->on("pu",rgb);
    kbd->on("pd",rgb);
    kbd->on("\r",rgb);
    kbd->on("up",rgb);
    kbd->on("right",rgb);
    kbd->show();
}

void MainWindow::on_pushButton_4_clicked()
{
    if(!kbd)return;
    char d[2]={0},str[]="`1234567890-=";
    QVector<int> vec;
    for(int i=0;i<sizeof(str);i++){
        d[0]=str[i];
        vec.append(kbd->conv(d));
    }
    vec.append(kbd->conv("back"));
    vec.append(kbd->conv("\\"));
    vec.append(kbd->conv("\r"));
    vec.append(kbd->conv("rshift"));
    vec.append(kbd->conv("rctrl"));
    vec.append(kbd->conv("menu"));
    vec.append(kbd->conv("fn"));
    vec.append(kbd->conv("ralt"));
    vec.append(kbd->conv(" "));
    vec.append(kbd->conv("lalt"));
    vec.append(kbd->conv("win"));
    vec.append(kbd->conv("lctrl"));
    vec.append(kbd->conv("lshift"));
    vec.append(kbd->conv("cl"));
    vec.append(kbd->conv("tab"));
    foreach(auto it,vec){
        kbd->on(it,0xFF00FF)->show();
        Sleep(10);
    }
}

void MainWindow::on_pushButton_5_clicked()
{
    if(!kbd)return;
    int i;
    char d[2]={0},str[]="asdfghjkl;'";
    for(int x=0;x<3;x++){
        for(i=0;i<sizeof(str)-1;i++){
            d[0]=str[i];
            kbd->on(d,0xFF0000);
            if(i){
                d[0]=str[i-1];
                kbd->off(d);
            }
            kbd->show();
            Sleep(30);
        }
        for(i=sizeof(str)-1;i>=0;i--){
            d[0]=str[i];
            kbd->on(d,0xFF0000);
            if(i<sizeof(str)){
                d[0]=str[i+1];
                kbd->off(d);
            }
            kbd->show();
            Sleep(30);
        }
    }
    kbd->clear()->show();
}

void MainWindow::on_pushButton_6_clicked()
{
    if(!kbd)return;
    kbd->clear();
    on_pushButton_4_clicked();
    on_pushButton_7_clicked();
}

void MainWindow::on_pushButton_7_clicked()
{
    if(!kbd)return;
    int i;
    char d[2]={0},*str[]={"asdfghjkl;'","qwertyuiop[]","zxcvbnm,./"};
    for(i=0;i<11;i++){
        d[0]=str[1][i];
        kbd->on(d,0xFF0000);
        if(i){
            d[0]=str[1][i-1];
            kbd->off(d);
        }
        kbd->show();
        Sleep(30);
    }
    for(i=11;i>=0;i--){
        d[0]=str[1][i];
        kbd->on(d,0xFF0000);
        if(i<12){
            d[0]=str[1][i+1];
            kbd->off(d);
        }
        kbd->show();
        Sleep(30);
    }
    for(i=0;i<12;i++){
        d[0]=str[1][i];
        kbd->on(d,0xff4300);
        d[0]=str[0][i];
        kbd->on(d,0x76ff00);
        d[0]=str[2][i];
        kbd->on(d,0x00e9ff);
        kbd->show();
        Sleep(30);
    }
}

void MainWindow::on_pushButton_8_clicked()
{
    if(!kbd)return;
    kbd->clear()->show();
}

void MainWindow::on_pushButton_9_clicked()
{
    if(!kbd)return;
    for(int x=0;;x+=20){
        if(x>255)x=255;
        int rgb=kbd->rgb(0,x,0);
        for(int i=0;i<17;i++){
            kbd->on(i,rgb);
        }
        kbd->on("ins",rgb);
        kbd->on("home",rgb);
        kbd->on("pu",rgb);
        kbd->on("del",rgb);
        kbd->on("end",rgb);
        kbd->on("pd",rgb);
        kbd->on("up",rgb);
        kbd->on("down",rgb);
        kbd->on("left",rgb);
        kbd->on("right",rgb);
        kbd->show();
        if(x==255)break;
        Sleep(30);
    }
}

void MainWindow::on_pushButton_10_clicked()
{
    on_pushButton_6_clicked();
    on_pushButton_9_clicked();
}
